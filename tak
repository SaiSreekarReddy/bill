@echo off
:begin
cls
set /p username=Enter your Jira username: 
set /p password=Enter your Jira password: 
set /p ticket=Enter the Jira ticket number: 
set /p testset=Enter the test set: 

:: Extract the project key from the ticket number (everything before the first hyphen)
for /f "tokens=1 delims=-" %%a in ("%ticket%") do set project_key=%%a

:: Get the current month in three-letter format (e.g., Jan, Feb)
for /f "tokens=2 delims==" %%i in ('wmic path win32_localtime get month /value') do set /a month=%%i
for /f "tokens=%month%" %%i in ("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec") do set this_month=%%i

:main
cls
set /p special=Enter the special word (type 'exit' to quit): 

if "%special%"=="exit" goto :end

echo Creating subtask with special word: %special%

:: Construct the JSON payload and handle quotes properly
set json_data={"fields":{"project":{"key":"%project_key%"},"parent":{"key":"%ticket%"},"summary":"please Upgrade the %special% in %testset% to %this_month%","issuetype":{"name":"Sub-task"}}}

:: Save the JSON to a temporary file to avoid issues with special characters
echo %json_data% > json_payload.txt

:: Use curl to create the subtask
curl -D- -u %username%:%password% -X POST -d @json_payload.txt -H "Content-Type: application/json" %jira_base_url%/rest/api/2/issue/

:: Cleanup
del json_payload.txt

:: Loop back to the beginning to ask for another special word
goto :main

:end
echo Exiting program...
exit
